/**
 * Kik Cards
 * Copyright (c) 2012 Kik Interactive, http://kik.com
 * All rights reserved
 * http://cards.kik.com/terms.html
 *
 * classList.js: Cross-browser full element.classList implementation.
 * By Eli Grey, http://eligrey.com
 * Public Domain
 * No warranty expressed or implied. Use at your own risk.
 *
 * json2.js
 * See http://www.JSON.org/js.html
 * Public Domain
 * No warranty expressed or implied. Use at your own risk.
*/
(function(a){var b={};b.enabled=false;b.version="0.10.1";b._={};a.cards=b})(window);(function(){if(!Object.keys){Object.keys=function(c){var b=[];for(var a in c){b.push(a)}return b}}if(!Array.isArray){Array.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,d){for(var b=d||0,a=this.length;b<a;b++){if((b in this)&&(this[b]===c)){return b}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(d,b){for(var c=0,a=this.length;c<a;c++){if(c in this){d.call(b,this[c],c,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(e,b){var a=this.length,c=new Array(a);for(var d=0;d<a;d++){if(d in this){c[d]=e.call(b,this[d],d,this)}}return c}}if(!Array.prototype.filter){Array.prototype.filter=function(e,c){var b=[];for(var f,d=0,a=this.length;d<a;d++){f=this[d];if((d in this)&&e.call(c,f,d,this)){b.push(f)}}return b}}if(!Array.prototype.reduce){Array.prototype.reduce=function(c,d){var b=0,a=this.length;if(typeof d=="undefined"){d=this[0];b=1}for(;b<a;b++){if(b in this){d=c(d,this[b],b,this)}}return d}}if(!String.prototype.trim){String.prototype.trim=function(){var a=/^\s+|\s+$/g;return function(){return String(this).replace(a,"")}}()}})();if(typeof document!=="undefined"&&!("classList" in document.createElement("a"))){(function(s){var B="classList",w="prototype",p=(s.HTMLElement||s.Element)[w],A=Object,r=String[w].trim||function(){return this.replace(/^\s+|\s+$/g,"")},z=Array[w].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++){if(b in this&&this[b]===a){return b}}return -1},o=function(b,a){this.name=b;this.code=DOMException[b];this.message=a},v=function(a,b){if(b===""){throw new o("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(b)){throw new o("INVALID_CHARACTER_ERR","String contains an invalid character")}return z.call(a,b)},y=function(a){var b=r.call(a.className),c=b?b.split(/\s+/):[],d=0,e=c.length;for(;d<e;d++){this.push(c[d])}this._updateClassName=function(){a.className=this.toString()}},x=y[w]=[],t=function(){return new y(this)};o[w]=Error[w];x.item=function(a){return this[a]||null};x.contains=function(a){a+="";return v(this,a)!==-1};x.add=function(a){a+="";if(v(this,a)===-1){this.push(a);this._updateClassName()}};x.remove=function(a){a+="";var b=v(this,a);if(b!==-1){this.splice(b,1);this._updateClassName()}};x.toggle=function(a){a+="";if(v(this,a)===-1){this.add(a)}else{this.remove(a)}};x.toString=function(){return this.join(" ")};if(A.defineProperty){var q={get:t,enumerable:true,configurable:true};try{A.defineProperty(p,B,q)}catch(u){if(u.number===-2146823252){q.enumerable=false;A.defineProperty(p,B,q)}}}else{if(A[w].__defineGetter__){p.__defineGetter__(B,t)}}}(self))}(function(f,h,d){var j=false,g=[];c();d._.onLog=i;function i(k){if(typeof k!=="function"){throw TypeError("log listener must be a function, got "+k)}g.push(k)}function e(l,k){if(j){return}j=true;g.forEach(function(n){try{n(l,k)}catch(m){}});j=false}function c(){var k=f.console;if(typeof k!=="object"){k={}}k.log=b(k.log,"log");k.warn=b(k.warn,"warn");k.error=b(k.error,"error");a();f.console=k}function b(k,l){switch(typeof k){case"undefined":k=function(){};case"function":break;default:return k}return function(){var m=Array.prototype.map.call(arguments,function(n){if((typeof n==="object")&&(n!==null)&&f.JSON&&JSON.stringify){try{return JSON.stringify(n)}catch(o){}}return n+""}).join(" ");e(l,m);k.apply(this,arguments)}}function a(){if(!f.addEventListener){return}f.addEventListener("error",function(k){e("exception",k.message+"")},false)}})(window,document,cards);(function(d,a,c){var b={};c.utils=b;b.error=function(e){if(d.console&&d.console.error){if((typeof e==="object")&&e.stack){d.console.error(e.stack)}else{d.console.error(e+"")}}};b.platform={};b.platform.os=function(){var h=d.navigator.userAgent,g,f,e;if((e=/\bCPU.*OS (\d+(_\d+)?)/i.exec(h))){g="ios";f=e[1].replace("_",".")}else{if((e=/\bAndroid (\d+(\.\d+)?)/.exec(h))){g="android";f=e[1]}else{if((e=/\bWindows Phone OS (\d+(\.\d+)?)/.exec(h))){g="winphone";f=e[1]}else{if((e=/\bMac OS X (\d+(_\d+)?)/.exec(h))){g="osx";f=e[1].replace("_",".")}else{if((e=/\bWindows NT (\d+(.\d+)?)/.exec(h))){g="windows";f=e[1]}else{if((e=/\bLinux\b/.exec(h))){g="linux";f=null}else{if((e=/\b(Free|Net|Open)BSD\b/.exec(h))){g="bsd";f=null}}}}}}}var i={name:g,version:f&&d.parseFloat(f),versionString:f};i[g]=true;return i}();b.platform.browser=function(){var h=d.navigator.userAgent,g,f,e;if((e=/\bMSIE (\d+(\.\d+)?)/i.exec(h))){g="msie";f=e[1]}else{if((e=/\bOpera\/(\d+(\.\d+)?)/i.exec(h))){g="opera";f=e[1];if((e=/\bVersion\/(\d+(\.\d+)?)/i.exec(h))){f=e[1]}}else{if((e=/\bChrome\/(\d+(\.\d+)?)/i.exec(h))){g="chrome";f=e[1]}else{if((h.indexOf("Safari/")!=-1)&&(e=/\bVersion\/(\d+(\.\d+)?)/i.exec(h))){if(b.platform.os.android){g="android"}else{g="safari"}f=e[1]}else{if((e=/\bFirefox\/(\d+(\.\d+)?)/i.exec(h))){g="firefox";f=e[1]}}}}}var i={name:g,version:f&&d.parseFloat(f),versionString:f};i[g]=true;return i}();b.platform.engine=function(){var h=d.navigator.userAgent,g,f,e;if((e=/\bTrident\/(\d+(\.\d+)?)/i.exec(h))){g="trident";f=e[1]}else{if((e=/\bMSIE 7/i.exec(h))){g="trident";f="3.1"}else{if((e=/\bPresto\/(\d+(\.\d+)?)/i.exec(h))){g="presto";f=e[1]}else{if((e=/\bAppleWebKit\/(\d+(\.\d+)?)/i.exec(h))){g="webkit";f=e[1]}else{if((e=/\brv\:(\d+(\.\d+)?)/i.exec(h))){g="gecko";f=e[1]}}}}}var i={name:g,version:f&&d.parseFloat(f),versionString:f};i[g]=true;return i}();b.random={};b.random.name=function(e){return("____"+(e||"")+"____"+Math.random()).replace(/\.|\-/g,"")};b.random.num=function(){return Math.floor((Math.random()*18014398509481984)-9007199254740992)};b.random.uuid=function(){var e=36,g=new Array(e),h="0123456789abcdef",f;for(f=0;f<e;f++){g[f]=Math.floor(Math.random()*16)}g[14]=4;g[19]=(g[19]&3)|8;for(f=0;f<e;f++){g[f]=h[g[f]]}g[8]=g[13]=g[18]=g[23]="-";return g.join("")};b.enumerate=function(f){if(typeof f!=="object"){f=Array.prototype.slice.call(arguments)}var h={};for(var g=0,e=f.length;g<e;g++){h[f[g]]=g}return h};b.preloadImage=function(){var f={};return e;function e(){var h=arguments;cards.ready(function(){g.apply(b,h)})}function g(j,l){if(typeof j!="string"){b.asyncJoin(j.map(function(m){return function(n){b.preloadImage(m,n)}}),l||function(){});return}if(f[j]===true){if(l){setTimeout(function(){l(true)},0)}return}else{if(f[j]){f[j].push(l);return}}f[j]=[l];var h=false;function k(o){if(h){return}h=true;var q=f[j];f[j]=o;for(var n,p=0,m=q.length;p<m;p++){n=q[p];if(n){n(o)}}}var i=new Image();i.onload=function(){k(true)};i.onerror=function(){k(false)};i.src=j}}();b.url={};b.url.dir=function(){var e=/\/[^\/]*$/;return function(f){switch(typeof f){case"undefined":f=d.location.href;case"string":break;default:throw TypeError("url "+f+" must be string if defined")}f=((f.split("?")[0]||"").split("#")[0]||"");return f.replace(e,"/")}}();b.url.host=function(){var e=/^https?\:\/\/([^\/]+)\/.*$/;return function(g){switch(typeof g){case"undefined":return d.location.host;case"string":break;default:throw TypeError("url "+g+" must be string if defined")}var f=e.exec(g);return f&&f[1]}}();b.url.path=function(){var e=/^https?\:\/\/[^\/]+(\/.*)$/;return function(g){switch(typeof g){case"undefined":return d.location.pathname;case"string":break;default:throw TypeError("url "+g+" must be string if defined")}var f=e.exec(g);return f&&f[1]}}();b.url.dataToQuery=function(){var e=/%20/g;return function(k){var h=[],j,f,i;for(var g in k){j=k[g];if((j!==null)&&(j!==undefined)){f=encodeURIComponent(g);i=encodeURIComponent(j);h.push(f+"="+i)}}return h.join("&").replace(e,"+")}}();b.url.queryToData=function(){var f=/([^&=]+)=([^&]+)/g,e=/\+/g;return function(k){var h={},g,i,j;if(k){k=k.replace(e,"%20");while((g=f.exec(k))){i=decodeURIComponent(g[1]);j=decodeURIComponent(g[2]);h[i]=j}}return h}}();b.url.withQuery=function(e,f){if(!f){f=e;e=d.location.href}e=e.split("?")[0];var g=b.url.dataToQuery(f);if(g){e+="?"+g}return e};b.url.updateQuery=function(e,f){if(!f){f=e;e=d.location.href}var g=b.url.parseQuery(e);b.obj.extend(g,f);return b.url.withQuery(e,g)};b.url.parseQuery=function(e){e=e||d.location.href;return b.url.queryToData(e.split("?")[1])};b.url.query=b.url.parseQuery();b.jsonp=function(s){var q=false,l=function(){},h=b.random.name("PICARD_UTILS_JSONP_CALLBACK"),e=s.url,i=b.obj.copy(s.data),m=s.callbackName||"callback",p=s.callback||l,f=s.success||l,j=s.error||l,o=s.complete||l,r=a.getElementsByTagName("script")[0],k=a.createElement("script");i[m]="window."+h;k.type="text/javascript";k.async=true;k.onerror=g;k.src=b.url.updateQuery(e,i);function n(){d[h]=l;try{r.parentNode.removeChild(k)}catch(t){}}function g(){if(q){return}n();p=l;f=l;j();j=l;o();o=l}d[h]=function(){q=true;n();p.apply(this,arguments);p=l;f.apply(this,arguments);f=l;j=l;o();o=l};if(s.timeout){setTimeout(g,s.timeout)}r.parentNode.insertBefore(k,r)};b.asyncJoin=function(e,k){var g=true;if(!Array.isArray(e)){g=false;e=Array.prototype.slice.call(arguments);k=e.pop()}var f=false,j=e.length,i=new Array(j);if(j===0){h();return}e.forEach(function(m,l){setTimeout(function(){var n=false;m(function(){if(n){return}n=true;if(i[l]){return}var o=Array.prototype.slice.call(arguments);i[l]=o;j--;h()})},0)});function h(){if((j!==0)||f){return}f=true;setTimeout(function(){if(g){k.call(d,i)}else{k.apply(d,i)}},0)}};b.obj={};b.obj.extend=function(g,f){for(var e in f){val1=g[e];val2=f[e];if(val1!==val2){g[e]=val2}}return g};b.obj.copy=function(e){return b.obj.extend({},e)};b.obj.forEach=function(g,h,e){for(var f in g){h.call(e,f,g[f],g)}};b.obj.inverse=function(g){var e={};for(var f in g){e[g[f]]=f}return e};b.obj.values=function(g){var e=[];for(var f in g){e.push(g[f])}return e};b.obj.has=function(g,f){for(var e in g){if(g[e]===f){return true}}return false};b.windowReady=function(f){if(a.readyState==="complete"){setTimeout(function(){f()},0);return}d.addEventListener("load",e,false);function e(){d.removeEventListener("load",e);setTimeout(function(){f()},0)}};b.ready=function(){var g=false,f=[];function h(){if(g){return}g=true;for(var k;(k=f.shift());){try{k()}catch(j){b.error(j)}}}function e(k){try{a.documentElement.doScroll("left")}catch(j){setTimeout(function(){e(k)},1);return}if(k){k()}}function i(l){if(a.readyState==="complete"){setTimeout(l,0);return}if(a.addEventListener){a.addEventListener("DOMContentLoaded",l,false);d.addEventListener("load",l,false)}else{if(a.attachEvent){a.attachEvent("onreadystatechange",l);d.attachEvent("onload",l);var j=false;try{j=(d.frameElement===null)}catch(k){}if(a.documentElement.doScroll&&j){setTimeout(function(){e(l)},0)}}}}i(h);return function(j){if(typeof j!=="function"){throw TypeError("callback "+j+" must be a function")}if(g){setTimeout(function(){j()},0)}else{f.push(j)}}}()})(window,document,cards);(function(f,a,e){e.events=d;e.events.handlers=g;function b(){this.handlers={};this.onceHandlers={};this.globalHandlers=[];this.globalOnceHandlers=[]}b.prototype.insureNamespace=function(i){if(!this.handlers[i]){this.handlers[i]=[]}if(!this.onceHandlers[i]){this.onceHandlers[i]=[]}};b.prototype.bind=function(i,j){this.insureNamespace(i);this.handlers[i].push(j)};b.prototype.bindToAll=function(i){this.globalHandlers.push(i)};b.prototype.bindOnce=function(i,j){this.insureNamespace(i);this.onceHandlers[i].push(j)};b.prototype.bindToAllOnce=function(i){this.globalOnceHandlers.push(i)};b.prototype.unbind=function(i,j){this.insureNamespace(i);h(this.handlers[i],j);h(this.onceHandlers[i],j)};b.prototype.unbindFromAll=function(j){h(this.globalHandlers,j);h(this.globalOnceHandlers,j);for(var i in this.handlers){h(this.handlers[i],j);h(this.onceHandlers[i],j)}};b.prototype.trigger=function(j,k,i){this.insureNamespace(j);if(typeof i==="undefined"){i=this}function l(m){try{m.call(i,k,j)}catch(n){e.utils.error(n)}}this.handlers[j].forEach(l);this.globalHandlers.forEach(l);this.onceHandlers[j].forEach(l);this.globalOnceHandlers.forEach(l);this.onceHandlers[j].splice(0);this.globalOnceHandlers.splice(0)};function h(j,l){for(var k=j.length;k--;){if(j[k]===l){j.splice(k,1)}}}function d(j){if(typeof j==="undefined"){j={}}var i=new b();j.on=function(k,l){if(Array.isArray(k)){k.forEach(function(m){j.on(m,l)});return}if(typeof l==="undefined"){l=k;k=""}if(typeof k!=="string"){throw TypeError("name "+k+" must be a string")}if(typeof l!=="function"){throw TypeError("handler "+l+" must be a function")}if(k){i.bind(k,l)}else{i.bindToAll(l)}};j.off=function(k,l){if(Array.isArray(k)){k.forEach(function(m){j.off(m,l)});return}if(typeof l==="undefined"){l=k;k=""}if(typeof k!=="string"){throw TypeError("name "+k+" must be a string")}if(typeof l!=="function"){throw TypeError("handler "+l+" must be a function")}if(k){i.unbind(k,l)}else{i.unbindFromAll(l)}};j.once=function(k,l){if(Array.isArray(k)){k.forEach(function(m){j.once(m,l)});return}if(typeof l==="undefined"){l=k;k=""}if(typeof k!=="string"){throw TypeError("name "+k+" must be a string")}if(typeof l!=="function"){throw TypeError("handler "+l+" must be a function")}if(k){i.bindOnce(k,l)}else{i.bindToAllOnce(l)}};j.trigger=function(l,m,k){if(Array.isArray(l)){l.forEach(function(n){j.trigger(n,m,k)});return}if(typeof l!=="string"){throw TypeError("name "+l+" must be a string")}i.trigger(l,m,k)};return j}function c(){this.handlers=[];this.events=[]}c.prototype.addHandler=function(i){this.handlers.push(i);return this.processEvents()};c.prototype.triggerEvent=function(i){this.events.push(i);this.processEvents()};c.prototype.triggerEvents=function(i){this.events=this.events.concat(i);this.processEvents()};c.prototype.processEvents=function(){if(!this.events.length||!this.handlers.length){return}var j=this.events.splice(0),i=this.handlers;j.forEach(function(k){i.forEach(function(l){l(k)})});return true};function g(){var i=new c();return{handler:function(j){return i.addHandler(j)},trigger:function(j){i.triggerEvent(j)},triggerMulti:function(j){i.triggerEvents(j)}}}})(window,document,cards);cards.ready=function(d,e){var b=[];a();return c;function c(g){if(b){b.push(g)}else{f(g)}}function a(){e.utils.windowReady(function(){setTimeout(function(){var g=b.slice();b=null;g.forEach(f)},3)})}function f(h){try{h()}catch(g){e.utils.error(g)}}}(window,cards);cards.open=function(c,f){var e=f.utils.platform.os,a=f.utils.platform.browser;c.open=function(g){d(g)};d.card=b;return d;function d(i,h){if(typeof i!=="string"){throw TypeError("url must be a string, got "+i)}switch(typeof h){case"object":h=JSON.stringify(h);case"undefined":case"string":break;default:throw TypeError("linkData must be a string of JSON if defined, got "+h)}if(f.browser&&f.browser.open){f.browser.open(i,h);return}if(h){i=i.split("#")[0]+"#"+encodeURIComponent(h)}var g=i.substr(0,7)==="card://",j=i.substr(0,8)==="cards://";if(!g&&!j){c.location.href=i;return}b(i,"http"+i.substr(4))}function b(i,g,h){if(!e.ios&&!e.android){if(g){c.location.href=g}return}if(e.ios||a.chrome){if(g){setTimeout(function(){if(!document.webkitHidden){c.location.href=g}},e.ios?25:1000)}if(h){f.ready(function(){setTimeout(function(){c.location.href=i},0)})}else{c.location.href=i}return}var k;if(g){k=setTimeout(function(){c.location=g},1000)}var j=document.createElement("iframe");j.style.position="fixed";j.style.top="0";j.style.left="0";j.style.width="1px";j.style.height="1px";j.style.border="none";j.style.opacity="0";j.onload=function(){if(g){clearTimeout(k)}try{document.documentElement.removeChild(j)}catch(l){}};j.src=i;document.documentElement.appendChild(j)}}(window,cards);(function(b,c){var a="__PICARD_ID__";if(!b.localStorage){return}if(!b.localStorage[a]){b.localStorage[a]=c.utils.random.uuid()}c._.id=b.localStorage[a]})(window,cards);(function(window){if(!window.chrome){return}if(!window.chrome.app){return}if(window.shimsham){return}var shimshamMeta=document.getElementById("shimsham-meta");if(shimshamMeta){var url=shimshamMeta.content;try{var xhr=new XMLHttpRequest();xhr.open("GET",url,false);xhr.timeout=1000;xhr.send(null);if(xhr.status===200){eval(xhr.responseText)}else{console.log("Failed to load shimsham, extension not installed get it at kik.com/cards")}}catch(e){}}})(window);(function(window,document,picard){var BRIDGE_SIGNAL_URL=window.location.protocol+"//cardsbridge.kik.com/",PLUGIN_REQUEST_BATCH="batch-call",PLUGIN_REQUEST_NAME="requestPlugin",PLUGIN_REQUEST_VERSION="requestVersion",PLUGIN_LOG="log";var plugins={},os=picard.utils.platform.os,androidBridge=window.CardsBridge;function validateBridge(){var bridgeInfo=validateAndroidBridge();if(bridgeInfo){return bridgeInfo}if(os.ios){return validateIPhoneBridge()}return false}function validateAndroidBridge(){if(!androidBridge){return false}if(typeof androidBridge.invokeFunction!=="function"){return false}if(typeof androidBridge.poll!=="function"){return false}return makeBridgeCall(PLUGIN_REQUEST_VERSION).data}function validateIPhoneBridge(){var bridgeInfo;try{bridgeInfo=makeBridgeCall(PLUGIN_REQUEST_VERSION).data}catch(err){}return bridgeInfo?bridgeInfo:false}function sendIFrameSignal(bridgeFunctionName,argData,asyncCallbackName){var callbackName=picard.utils.random.name("PICARD_BRIDGE_CALLBACK"),status,data;window[callbackName]=function(callbackStatus,callbackData){delete window[callbackName];status=callbackStatus;data=callbackData};var url=BRIDGE_SIGNAL_URL+bridgeFunctionName+"/"+callbackName+"?args="+encodeURIComponent(argData)+"&async="+(asyncCallbackName||"");var doc=document.documentElement,iframe=document.createElement("iframe");iframe.style.display="none";iframe.src=url;doc.appendChild(iframe);doc.removeChild(iframe);if(window[callbackName]){delete window[callbackName];throw Error("bridge call "+bridgeFunctionName+" failed to return")}return{status:status,data:data}}function sendBatchIFrameSignal(urls){var calls=urls.map(function(url){return encodeURIComponent(url)}).join(",");var url=BRIDGE_SIGNAL_URL+PLUGIN_REQUEST_BATCH+"?calls="+calls;var doc=document.documentElement,iframe=document.createElement("iframe");iframe.style.display="none";iframe.src=url;doc.appendChild(iframe);doc.removeChild(iframe)}function androidBridgeCall(bridgeFunctionName,argData,asyncCallbackName){var response,result;if(!asyncCallbackName){response=androidBridge.invokeFunction(bridgeFunctionName,argData)}else{if(androidBridge.invokeAsyncFunction){response=androidBridge.invokeAsyncFunction(bridgeFunctionName,argData,asyncCallbackName)}else{throw TypeError("bridge: android bridge does not support async callbacks")}}try{result=JSON.parse(response)}catch(err){throw TypeError("bridge call for "+bridgeFunctionName+" responded with invalid JSON")}return{status:result.status,data:result.data}}function makeBridgeCall(bridgeFunctionName,args,asyncCallback){if(typeof bridgeFunctionName!=="string"){throw TypeError("bridge call "+bridgeFunctionName+" must be a string")}switch(typeof args){case"function":asyncCallback=args;args=undefined;case"undefined":args={};case"object":break;default:throw TypeError("bridge call arguments "+args+" must be a JSON object if specified")}switch(typeof asyncCallback){case"undefined":case"function":break;default:throw TypeError("bridge async callback must be a function if defined, got "+asyncCallback)}var argData;try{argData=JSON.stringify(args)}catch(err){throw TypeError("bridge call arguments "+args+" must be a JSON object")}var asyncCallbackName;if(asyncCallback){asyncCallbackName=setupAsyncCallback(asyncCallback)}var result;if(androidBridge){result=androidBridgeCall(bridgeFunctionName,argData,asyncCallbackName)}else{result=sendIFrameSignal(bridgeFunctionName,argData,asyncCallbackName)}if(asyncCallbackName&&(!result||!result.status||(result.status!==202))){delete window[asyncCallbackName]}return result}function setupAsyncCallback(asyncCallback){var callbackName=picard.utils.random.name("PICARD_BRIDGE_ASYNC_CALLBACK");window[callbackName]=function(status,data){delete window[callbackName];if(androidBridge){try{var response=JSON.parse(status);status=response.status;data=response.data}catch(err){throw Error("bridge failed to parse android async data, "+status)}}if((typeof data!=="object")||(data===null)){asyncCallback()}else{if(!status||(status<200)||(status>=300)){asyncCallback()}else{asyncCallback(data)}}};return callbackName}function setupEventCallback(eventCallback){var callbackName=picard.utils.random.name("PICARD_BRIDGE_EVENT_CALLBACK");window[callbackName]=function(name,data){if(androidBridge){try{data=JSON.parse(data)}catch(err){throw Error("bridge failed to parse android event data, "+data)}}eventCallback(name,data)};return callbackName}function setupAndroidPoll(){window.addEventListener("keyup",function(e){if(e.which!==0){return}performAndroidPoll();return false})}function performAndroidPoll(){var code=androidBridge.poll()+"";if(!code){return}try{eval(code)}catch(err){if(window.console&&window.console.error){window.console.error("android poll failed to evaluate "+code+", "+err)}}performAndroidPoll()}function setupIOSLogging(){picard._.onLog(function(level,message){makeBridgeCall(PLUGIN_LOG,{level:level,message:message})})}function bridgeFunctionCall(bridgeFunctionName,args,callback){var data=makeBridgeCall(bridgeFunctionName,args,callback);if(!data){throw Error("bridge call "+bridgeFunctionName+" did not return")}if(!data.status||(data.status<200)||(data.status>=300)){throw Error("bridge call "+bridgeFunctionName+" did not complete successfully, "+data.status)}if(typeof data.data!=="object"){throw TypeError("bridge call "+bridgeFunctionName+" did not return an object, "+data.data)}return data.data}function setupFunction(bridgeFunctionName){return function(args,callback){return bridgeFunctionCall(bridgeFunctionName,args,callback)}}function setupFunctions(namespace,functionNames,pluginObj){if(!Array.isArray(functionNames)){throw TypeError("functions "+functionNames+" must be an array")}if(typeof pluginObj==="undefined"){pluginObj={}}functionNames.forEach(function(functionName){if(typeof functionName!=="string"){throw TypeError("function "+functionName+" must be a string")}pluginObj[functionName]=setupFunction(namespace+"."+functionName)})}function setupPlugin(pluginName){var pluginObj=picard.events(),pluginData=makeBridgeCall(PLUGIN_REQUEST_NAME,{name:pluginName,eventCallback:setupEventCallback(pluginObj.trigger)});if(pluginData.status!==200){throw TypeError("plugin "+pluginName+" failed to initialize")}setupFunctions(pluginName,pluginData.data.functions,pluginObj);return pluginObj}function bridge(pluginName){if(typeof pluginName!=="string"){throw TypeError("plugin name must be a string, got "+pluginName)}if(!plugins[pluginName]){var plugin=setupPlugin(pluginName);plugins[pluginName]=plugin}return plugins[pluginName]}function batchRequest(calls){if(!Array.isArray(calls)){throw TypeError("batch calls must be an array, got "+calls)}calls.forEach(function(data){if(typeof data!=="object"){throw TypeError("batch call must be an object, got "+data)}if(typeof data.name!=="string"){throw TypeError("batch call name must be a string, got "+data.name)}switch(typeof data.args){case"undefined":case"object":break;default:throw TypeError("batch call args must be an object if defined, got "+data.args)}switch(typeof data.callback){case"function":case"undefined":break;default:throw TypeError("batch call callback must be a function if defined, got "+data.callback)}});if(androidBridge){return calls.map(function(data){try{if(data.name.indexOf(".")===-1){return bridge(data.name)}else{return bridgeFunctionCall(data.name,data.args,data.callback)}}catch(err){}})}var batchCalls=[],responses=new Array(calls.length);calls.forEach(function(data,index){var isPluginRequest=(data.name.indexOf(".")===-1);if(!isPluginRequest){batchCalls.push(generateBatchSegment(data,function(responseData){responses[index]=responseData}))}else{if(plugins[data.name]){responses[index]=plugins[data.name]}else{batchCalls.push(generatePluginBatchSegment(data,function(responseData){responses[index]=responseData}))}}});sendBatchIFrameSignal(batchCalls);return responses}function generateBatchSegment(data,callback){var argData=JSON.stringify(data.args);var asyncCallbackName;if(data.callback){asyncCallbackName=setupAsyncCallback(data.callback)}var callbackName=picard.utils.random.name("PICARD_BRIDGE_CALLBACK");setTimeout(function(){delete window[callbackName]},0);window[callbackName]=function(callbackStatus,callbackData){delete window[callbackName];if(asyncCallbackName&&callbackStatus!==202){delete window[asyncCallbackName]}if(callbackStatus>=200&&callbackStatus<300){callback(callbackData)}};var url=BRIDGE_SIGNAL_URL+data.name+"/"+callbackName+"?args="+encodeURIComponent(argData)+"&async="+(asyncCallbackName||"");return url}function generatePluginBatchSegment(data,callback){var pluginObj=picard.events(),argData=JSON.stringify({name:data.name,eventCallback:setupEventCallback(pluginObj.trigger)});var callbackName=picard.utils.random.name("PICARD_BRIDGE_CALLBACK");setTimeout(function(){delete window[callbackName]},0);window[callbackName]=function(callbackStatus,callbackData){delete window[callbackName];if(callbackStatus===200){setupFunctions(data.name,callbackData.functions,pluginObj);plugins[data.name]=pluginObj;callback(pluginObj)}};var url=BRIDGE_SIGNAL_URL+PLUGIN_REQUEST_NAME+"/"+callbackName+"?args="+encodeURIComponent(argData)+"&async=";return url}function redirectToCards(){var os=picard.utils.platform.os,urllib=picard.utils.url;if(!urllib.query.kikme||(!os.ios&&!os.android)){return}try{var iframe=document.createElement("iframe");iframe.src="card"+urllib.updateQuery({kikme:null}).substr(4);iframe.style.display="none";var cleanup=function(){try{document.documentElement.removeChild(iframe)}catch(err){}};iframe.onload=cleanup;iframe.onerror=cleanup;setTimeout(cleanup,1000);document.documentElement.appendChild(iframe)}catch(err){}}function main(){var bridgeInfo=validateBridge();if(!bridgeInfo){redirectToCards();return}picard._.bridge=bridge;picard._.bridge.batch=batchRequest;if(androidBridge){setupAndroidPoll();picard._.bridge.forceAndroidPoll=performAndroidPoll}else{setupIOSLogging()}picard.enabled=true;bridge.info=bridgeInfo;bridge.version=bridgeInfo.version;picard.utils.platform.browser.name="cards";picard.utils.platform.browser.cards=true;picard.utils.platform.browser.version=window.parseFloat(bridge.version);picard.utils.platform.browser.versionString=bridge.version}main()})(window,document,cards);(function(d){var b={};d._.firstBatch=b;if(!d._.bridge||!d.utils.platform.os.ios||(d.utils.platform.browser.version<6.5)){return}var a=[{name:"Metrics"},{name:"Browser"},{name:"Media"},{name:"Kik"},{name:"Profile"},{name:"UserData"},{name:"Auth"},{name:"Photo"},{name:"Keyboard"},{name:"Push"},{name:"Picker"}];var c=[{name:"Browser.getLastLinkData",args:{}},{name:"Kik.getLastMessage",args:{}},{name:"Push.getNotificationList",args:{}},{name:"Push.setBadgeVisibility",args:{visible:false}},{name:"Picker.getRequest",args:{}}];d._.bridge.batch(a.concat(c)).slice(a.length).forEach(function(e,g){var f=c[g];b[f.name]=e;if(!e){}else{if(!d._.secondBatch){d._.secondBatch=[]}}})})(cards);(function(b,g){var c="kik-transform-fix";if(a()){d()}function a(){var h=true;if(!g.enabled){h=false}else{if(!g.utils.platform.os.android){h=false}else{Array.prototype.forEach.call(b.getElementsByTagName("meta"),function(i){if((i.name===c)&&(i.content==="false")){h=false}})}}return h}function d(){var h=b.documentElement;e(h,"translate3d(0,0,0)");setTimeout(function(){f(h,"transform 10ms linear");setTimeout(function(){e(h,"translate3d(0,0,1px)");setTimeout(function(){f(h,"");setTimeout(function(){e(h,"")},0)},10)},0)},0)}function e(i,h){i.style["-webkit-transform"]=h;i.style["-moz-transform"]=h;i.style["-ms-transform"]=h;i.style["-o-transform"]=h;i.style.transform=h}function f(h,i){if(i){h.style["-webkit-transition"]="-webkit-"+i;h.style["-moz-transition"]="-moz-"+i;h.style["-ms-transition"]="-ms-"+i;h.style["-o-transition"]="-o-"+i;h.style.transition=i}else{h.style["-webkit-transition"]="";h.style["-moz-transition"]="";h.style["-ms-transition"]="";h.style["-o-transition"]="";h.style.transition=""}}})(document,cards);(function(h,a){var e;try{e=a._.bridge("Metrics")}catch(d){}var j=a.events(),g=[];a.metrics=j;j.loadTime=null;j.coverTime=null;if(e){e.on("loadData",function(m){if(typeof m.loadTime==="number"){j.loadTime=m.loadTime;j.trigger("loadTime",m.loadTime)}if(typeof m.coverTime==="number"){j.coverTime=m.coverTime;j.trigger("coverTime",m.coverTime)}})}var l=false;j.enableGoogleAnalytics=k;j.logEvent=i;function k(n,m){if(l){return}l=true;if(n){c(n,m)}f()}function c(n,m){if(typeof n!=="string"){throw TypeError("google analytics ID must be a string, got "+n)}if(typeof m!=="string"){throw TypeError("google analytics host must be a string, got "+m)}h.GoogleAnalyticsObject="ga";h.ga=h.ga||function(){(h.ga.q=h.ga.q||[]).push(arguments)},h.ga.l=+new Date();a.ready(function(){var o=document.createElement("script"),p=document.getElementsByTagName("script")[0];o.async=1;o.src="//www.google-analytics.com/analytics.js";p.parentNode.insertBefore(o,p)});h.ga("create",n,m);h.ga("send","pageview")}function f(){h.addEventListener("error",function(q){var p=q.message||"";p+=" ("+(q.filename||h.location.href);if(q.lineno){errorFile+=":"+q.lineno}p+=")";i("error",p)},false);if((typeof App==="object")&&(typeof App.enableGoogleAnalytics==="function")){App.enableGoogleAnalytics()}if(e){b("loadTime");b("coverTime")}if(a.kik&&a.kik.hasPermission){var m;try{m=a.kik.hasPermission()}catch(n){}if(typeof m==="boolean"){i("linked",m?1:0)}}var o=g.slice();g=null;o.forEach(function(p){i(p[0],p[1],p[2])})}function i(n,m,o){if(g){g.push([n,m,o]);return}switch(typeof m){case"number":o=m;m=undefined;case"undefined":case"string":break;default:return}switch(typeof o){case"number":o=Math.floor(o);case"undefined":break;default:return}if((typeof m==="undefined")&&(typeof o==="undefined")){return}if(typeof h.ga==="function"){h.ga("send","event","Cards",n,m,o);return}if(!h._gaq){h._gaq=[]}if(typeof h._gaq.push==="function"){h._gaq.push(["_trackEvent","Cards",n,m,o,true])}}function b(m){i(m,j[m]);j.on(m,function(){i(m,j[m])})}})(window,cards);(function(j,p,o){function s(B,F){var A=j.applicationCache,E=false;if(!A||!A.addEventListener||!A.swapCache||!A.update){F(false);return}if(A.status===A.UPDATEREADY){z();return}if((A.status!==A.IDLE)&&(A.status!==A.CHECKING)&&(A.status!==A.DOWNLOADING)){F(false);return}A.addEventListener("noupdate",C,false);A.addEventListener("updateready",z,false);A.addEventListener("error",z,false);A.addEventListener("obsolete",z,false);setTimeout(z,30*1000);if(A.status===A.IDLE){try{A.update()}catch(D){z()}}function C(){if(E){return}E=true;if(!B&&j.console&&j.console.log){j.console.log("refresh requested but no update to manifest found");j.console.log("** update your manifest to see changes reflected")}setTimeout(function(){F(true)},1000)}function z(){if(E){return}E=true;var G=false;if(A.status===A.UPDATEREADY){try{A.swapCache();G=true}catch(H){}}F(G)}}if(o.utils.platform.os.ios){setTimeout(function(){s(true,function(z){})},5000)}j.ZERVER_REFRESH=function(){c();s(true,function(){j.location.reload()})};function c(){try{j.ZERVER_KILL_STREAM()}catch(z){}}function i(B){if(typeof B!=="string"){return undefined}B=decodeURIComponent(B);var z;try{z=JSON.parse(B)}catch(A){}if((typeof z==="object")&&(z!==null)){return z}else{return B||undefined}}if(j.location.hash){o.linkData=i(j.location.hash.substr(1))}var a;try{a=o._.bridge("Browser")}catch(d){return}var w=o.events();o.browser=w;var y={};if(a.setCardInfo){var m=/(^|\s)icon(\s|$)/i,u,g,x,h;Array.prototype.forEach.call(p.getElementsByTagName("link"),function(z){if(!u){if((z.rel==="kik-icon")||(m.test(z.rel)&&!u)){u=z.href}}if(!g){if(z.rel==="kik-tray-icon"){g=z.href}}if(!x){if(z.rel==="privacy"){x=z.href}}if(!h){if(z.rel==="terms"){h=z.href}}});var l={title:p.title,icon:u,mediaTrayIcon:g,privacy:x,terms:h};if(cards._.secondBatch){cards._.secondBatch.push({name:"Browser.setCardInfo",args:l})}else{a.setCardInfo(l)}}if(a.pageLoaded){o.utils.windowReady(function(){if(p.body){var z=p.body.offsetWidth;(function(A){return A})(z)}setTimeout(function(){a.pageLoaded()},1)})}j.addEventListener("unload",function(){if(a.navigationAttempted){a.navigationAttempted()}},false);var r=true;if(a.setStatusBarVisible){var k=false;w.statusBar=function(z){k=true;a.setStatusBarVisible({visible:!!z});r=!!z}}if(a.getOrientationLock&&a.setOrientationLock){w.getOrientationLock=function(){var z=a.getOrientationLock().position;return(z==="free")?null:z};w.setOrientationLock=function(z){switch(z){case"free":case"portrait":case"landscape":break;default:if(!z){z="free";break}throw TypeError("if defined, position "+z+' must be one of "free", "portrait", or "landscape"')}try{a.setOrientationLock({position:z});if(!k&&a.setStatusBarVisible&&(r!==(z!=="landscape"))){a.setStatusBarVisible({visible:(z!=="landscape")});r=(z!=="landscape")}return true}catch(A){return false}};if(j.screen&&!j.screen.lockOrientation){j.screen.lockOrientation=function(z){if(arguments.length>1){return false}switch(z){case"landscape":case"portrait":break;default:return false}return w.setOrientationLock(z)};j.screen.unlockOrientation=function(){return w.setOrientationLock("free")};if(!j.screen.orientation){j.screen.orientation=(j.innerHeight>=j.innerWidth?"portrait":"landscape");a.on("orientationChanged",function(z){j.screen.orientation=z.orientation})}}}a.on("orientationChanged",function(){if(j.App&&j.App._layout){try{j.App._layout()}catch(z){}}});if(a.setBacklightTimeoutEnabled){w.backlightTimeout=function(z){a.setBacklightTimeoutEnabled({enabled:!!z})}}if(a.forceRepaint){w.paint=function(){if(p.body){var z=p.body.offsetWidth;(function(A){return A})(z)}a.forceRepaint()}}if(a.handleBack){var e=[];w.back=function(z){if(typeof z!=="function"){throw TypeError("back handler "+z+" must be a function")}e.push(z)};w.unbindBack=function(A){if(typeof A!=="function"){throw TypeError("back handler "+A+" must be a function")}for(var z=e.length;z--;){if(e[z]===A){e.splice(z,1)}}};a.on("back",function(C){var A=false;for(var z=e.length;z--;){try{if(e[z]()===false){A=true;break}}catch(B){o.utils.error(B)}}a.handleBack({requestToken:C.requestToken,override:A})});w.back(function(){if(j.App&&(typeof j.App.back==="function")){try{if(App.back()!==false){return false}}catch(z){}}})}if(a.refresh&&a.refreshPlanned){w.refresh=function(){var z=j.applicationCache;c();if(!z||(z.status===z.UNCACHED)){a.refresh({withCache:false});return}s(false,function(A){a.refresh({withCache:true})})};a.on("refresh",function(){setTimeout(function(){a.refreshPlanned();w.refresh()},0)});j.ZERVER_REFRESH=function(){w.refresh()}}if(a.openCard&&a.openExternal){w.open=function(B,A,C){if(typeof B!=="string"){throw TypeError("url "+B+" must be a string")}switch(typeof A){case"undefined":case"string":break;case"object":A=JSON.stringify(A);break;default:throw TypeError("card linkData must be a string or JSON if defined, got "+A)}switch(typeof C){case"undefined":C={};break;case"object":break;default:throw TypeError("card data must be an object if defined, got "+C)}var z=B.substr(0,7)==="card://",D=B.substr(0,8)==="cards://";if(!z&&!D){a.openExternal({url:B});return}B="http"+B.substr(4);if(A){B=B.split("#")[0]+"#"+encodeURIComponent(A)}a.openCard({url:B,title:C.title||undefined,icon:C.icon||undefined,clearHistory:!!C.clearHistory})}}function q(A,z){w.linkData=i(A&&A.data);o.linkData=w.linkData;if((z!==false)&&w.linkData){w.trigger("linkData",w.linkData)}}w._processLinkData=q;if(a.getLastLinkData){q(cards._.firstBatch["Browser.getLastLinkData"]||a.getLastLinkData(),false)}a.on("linkData",q);var n=true,v=false,t=true;w.background=n;a.on("pause",function(z){v=true;f()});a.on("unpause",function(z){v=false;f()});a.on("conceal",function(z){t=true;f()});a.on("reveal",function(z){t=false;f()});function b(){return v||t}function f(){var z=n;n=b();w.background=n;if(z!==n){w.trigger(n?"background":"foreground")}}})(window,document,cards);(function(c,a,b){if(b._.bridge){c.alert=function(){};c.confirm=function(){};c.prompt=function(){}}})(window,document,cards);(function(g,c,f){var d;try{d=f._.bridge("Media")}catch(e){}if(!d||!d.setMediaCategory||!d.unsetMediaCategory){f._mediaEnabled=function(){}}else{f._mediaEnabled=a;b()}function b(){var h=false;Array.prototype.forEach.call(c.getElementsByTagName("meta"),function(i){if((i.name==="kik-media-enabled")&&(i.content==="true")){h=true}});a(h)}function a(h){if(cards._.secondBatch){cards._.secondBatch.push({name:"Media."+(h?"":"un")+"setMediaCategory",args:{}})}else{try{if(h){d.setMediaCategory()}else{d.unsetMediaCategory()}}catch(i){}}}})(window,document,cards);(function(j,k,i){var c;try{c=i._.bridge("Kik")}catch(f){return}var b=i.events();i.kik=b;b._formatMessage=e;function e(o){var m;if(typeof o!=="object"){throw TypeError("message "+o+" must be an object")}switch(typeof o.big){case"undefined":case"boolean":break;default:throw TypeError("message size (big) "+o.big+" must be a boolean if defined")}switch(typeof o.title){case"undefined":case"string":if(!o.big&&!o.title){throw TypeError("message title must be a string")}o.title=o.title||"";break;default:throw TypeError("message title "+o.title+" must be a string")}switch(typeof o.text){case"string":case"undefined":break;default:throw TypeError("message text "+o.text+" must be a string")}switch(typeof o.pic){case"undefined":case"string":break;default:throw TypeError("message pic "+o.pic+" must be a string if defined")}switch(typeof o.noForward){case"undefined":case"boolean":break;default:throw TypeError("message noForward flag must be a boolean if defined, got "+o.noForward)}switch(typeof o.fallback){case"undefined":case"string":break;default:throw TypeError("message fallback URL must be a string if defined, got "+o.fallback)}switch(typeof o.linkData){case"undefined":case"string":break;case"object":try{m=JSON.stringify(o.linkData)}catch(n){throw TypeError("message linkData must be a string or JSON if defined, got "+o.linkData)}break;default:throw TypeError("message linkData must be a string or JSON if defined, got "+o.linkData)}var p=m||o.linkData;if(typeof p==="string"){p=encodeURIComponent(p)}var m;switch(typeof o.data){case"object":if(o.data!==null){try{m=JSON.stringify(o.data)}catch(n){throw TypeError("message data must be a json object if defined, got "+o.data)}}case"undefined":break;default:throw TypeError("message data must be a json object if defined, got "+o.data)}var l;if((typeof o.data==="object")&&(o.data!==null)&&o.data.id){l=o.data.id+""}cards.metrics.logEvent("kikSend",l);return{title:o.title,text:o.text,image:o.pic,forwardable:!o.noForward,fallbackUrl:o.fallback,layout:o.big?"photo":"article",extras:{sender:i._.id,dataID:l,messageID:i.utils.random.uuid(),linkData:p||"",jsonData:m||""}}}b.send=function(m,l){if(typeof m!=="string"){l=m;m=undefined}l=e(l);l.targetUser=m;if(m&&c.sendKikToUser){c.sendKikToUser(l)}else{c.sendKik(l)}};var h=i.events.handlers();b.handler=function(l){return h.handler(l)};function g(o,l){a();if(!o.extras.sender||(o.extras.sender!==i._.id)){cards.metrics.logEvent("kikReceive",o.extras.dataID)}if(o.extras.jsonData){var m;try{m=JSON.parse(o.extras.jsonData)}catch(n){}if((typeof m==="object")&&(m!==null)){b.message=m;h.trigger(m);b.trigger("message",m)}}if(o.extras&&o.extras.linkData&&i.browser&&i.browser._processLinkData){i.browser._processLinkData({data:o.extras.linkData},l)}}if(c.getLastMessage){var d=cards._.firstBatch["Kik.getLastMessage"]||c.getLastMessage();if(d&&d.message){g(d.message,false)}}c.on("message",g);if(c.openConversation){b.open=function(){c.openConversation()}}function a(){if(!c.openConversation){return}b.returnToConversation=function(l){b.returnToConversation=null;if(!l){c.openConversation({returnToSender:true});return}l=e(l);l.returnToSender=true;c.sendKik(l)}}})(window,document,cards);(function(f,a,e){var b;try{b=e._.bridge("Profile")}catch(d){return}var c=e.kik;if(!c){c=e.events();e.kik=c}if(b.openProfile){c.showProfile=function(h){if(typeof h!=="string"){throw TypeError("username must be a string, got "+h)}try{b.openProfile({username:h})}catch(g){}}}})(window,document,cards);(function(i,j,g){var l;try{l=g._.bridge("UserData")}catch(d){return}var b=g.kik;if(!b){b=g.events();g.kik=b}function k(m){m.fullName=(m.displayName||"");var n=m.fullName.indexOf(" ");if(n===-1){m.firstName=m.fullName;m.lastName=""}else{m.firstName=m.fullName.substr(0,n);m.lastName=m.fullName.substr(n+1)}delete m.displayName;m.pic=e(m.pic);m.thumbnail=e(m.thumbnail);return m}function e(m){if(typeof m!=="string"){return m}var n=m.replace(/^https?\:\/\/[^\/]*/,"");return"//d33vud085sp3wg.cloudfront.net"+n}var f;if(l.getUserData){b.getUser=function(m){switch(typeof m){case"undefined":m=function(){};case"function":break;default:throw TypeError("callback must be a function if defined, got "+m)}h(m)}}function h(n){if(f){setTimeout(function(){n(f)},0);return}var m=b.hasPermission?b.hasPermission():false;l.getUserData({fields:["profile"]},function(p){var o=p&&p.userData;if(!m){g.metrics.logEvent("link-request",(o?1:0))}if(!o){n();return}k(o);f=o;n(o)})}if(l.checkPermissions){b.hasPermission=function(){try{return !!l.checkPermissions({fields:["profile"]}).permitted}catch(m){return false}}}if(l.pickUsers||l.pickFilteredUsers){b.pickUsers=function(m,n){switch(typeof m){case"function":n=m;case"undefined":m={};case"object":break;default:throw TypeError("options must be an object if defined, got "+m)}if(typeof n!=="function"){throw TypeError("callback must be a function, got "+n)}switch(typeof m.preselected){case"undefined":m.preselected=[];break;default:if(!Array.isArray(m.preselected)){throw TypeError("preselected users must be an array of users if defined, got "+m.preselected)}m.preselected.forEach(function(o){if(typeof o!=="object"){throw TypeError("user must be an object, got "+o)}if(typeof o.username!=="string"){throw TypeError("user.username must be a string, got "+o.username)}});break}switch(typeof m.filtered){case"undefined":m.filtered=[];break;default:if(!Array.isArray(m.filtered)){throw TypeError("filtered users must be an array of users if defined, got "+m.filtered)}m.filtered=m.filtered.map(function(o){switch(typeof o){case"string":return o;case"object":if(typeof o.username==="string"){return o.username}default:throw TypeError("filtered user didnt have a username, got "+o)}});break}switch(typeof m.filterSelf){case"undefined":case"boolean":break;default:throw TypeError("filterSelf must be a boolean if defined, got "+m.filterSelf)}switch(typeof m.minResults){case"undefined":break;case"number":if(m.minResults<0){throw TypeError("minResults must be non-negative if defined, got "+m.minResults)}break;default:throw TypeError("minResults must be a number if defined, got "+m.minResults)}switch(typeof m.maxResults){case"undefined":break;case"number":if(m.maxResults<1){throw TypeError("maxResults must be greater than 1 if defined, got "+m.maxResults)}break;default:throw TypeError("maxResults must be a number if defined, got "+m.maxResults)}switch(typeof n){case"undefined":n=function(){};break;case"function":break;default:throw TypeError("callback must be a function if defined, got "+n)}if(m.preselected.length&&m.filtered.length){throw TypeError("can only preselect or filter users, not both")}if(l.pickFilteredUsers&&!m.preselected.length){c(m,n)}else{a(m,n)}}}function c(m,n){m.minResults=m.minResults||1;l.pickFilteredUsers({minResults:m.minResults,maxResults:m.maxResults,filtered:m.filtered,filterSelf:m.filterSelf},function(o){if(!o||!o.userDataList){n();return}var p=o.userDataList.map(k);if(m.filtered){p=p.filter(function(q){return m.filtered.indexOf(q.username)===-1})}n(p)})}function a(o,s){var q=false;if(!o.preselected||!o.preselected.length){o.minResults=o.minResults||1}var m={},p=[];o.preselected.forEach(function(t){m[t.username]=t;p.push(t.username)});l.pickUsers({minResults:o.minResults,maxResults:o.maxResults,preselected:p},function(t){if(q){return}if(!t||!t.userDataList){q=true;s();return}var u=t.userDataList.map(function(v){if(v.username in m){return m[v.username]}else{return k(v)}});q=true;s(u)});var r=cards.utils.platform.os;var n=cards.utils.platform.browser;if(r.ios&&n.cards&&n.version<6.5){cards.browser.once("foreground",function(){setTimeout(function(){if(!q){q=true;s()}},0)})}}})(window,document,cards);(function(f,a,e){var b;try{b=e._.bridge("Auth")}catch(d){return}var c=e.kik;if(!c){c=e.events();e.kik=c}if(b.signRequest){c.sign=function(h,i){if(e.utils.platform.os.android){cards.ready(function(){g(h,i)})}else{g(h,i)}}}function g(h,i){b.signRequest({request:h},function(l){if(!l||!l.signedRequest){i();return}var k=e.utils.platform.os,j=l.host;if(!j){j=f.location.host;if(k.android){j+=f.location.pathname;if(j[j.length-1]==="/"){j=j.substr(0,j.length-1)}}}i(l.signedRequest,l.username,j)})}})(window,document,cards);(function(f,h,d){var i;try{i=d._.bridge("Photo")}catch(b){return}var a=d.events();d.photo=a;if(i.getPhoto){a.get=function(j,k){e(j,k)};a.getFromCamera=function(j,k){e("camera",j,k)};a.getFromGallery=function(j,k){e("gallery",j,k)}}function c(j,k){switch(typeof k){case"undefined":case"function":break;default:throw TypeError(j+" must be a function if defined, got "+k)}}function g(j,l,k,m){switch(typeof l){case"undefined":break;case"number":if(l<k||l>m){throw TypeError(j+" must be within "+k+" and "+m+" if defined, got "+l)}break;default:throw TypeError(j+" must be a number if defined, got "+l)}}function e(j,x,w){if(typeof j!=="string"){w=x;x=j;j=undefined}switch(typeof x){case"function":w=x;x={};case"object":break;default:throw TypeError("options must be an object, got "+x)}c("callback",w);c("onCancel",x.onCancel);c("onSelect",x.onSelect);c("onPhoto",x.onPhoto);c("onComplete",x.onComplete);g("quality",x.quality,0,1);g("minResults",x.minResults,0,25);g("maxResults",x.maxResults,1,25);g("maxHeight",x.maxHeight,0,1280);g("maxWidth",x.maxWidth,0,1280);var q=x.onSelect,s=x.onCancel,u=x.onPhoto,l=x.onComplete,r=false,p,t;try{i.getPhoto({source:j,quality:x.quality,minResults:x.minResults,maxResults:x.maxResults,maxHeight:x.maxHeight,maxWidth:x.maxWidth,autoSave:x.saveToGallery},n)}catch(m){if(!r){r=true;o(s);o(w)}}function n(y){if(r){return}r=true;p=y&&y.photoIds;var z=p&&p.length;if(!z){o(s);o(w);return}o(q,z);t=new Array(z);i.on("photo",v)}function v(C){if(!C){return}var A=p.indexOf(C.id);if(A===-1){return}C.url=C.url||null;p[A]=null;t[A]=C.url;var z=0;for(var B=0,y=p.length;B<y;B++){if(p[B]!==null){z++}}o(u,C.url,A);if(z===0){k()}}function k(){i.off("photo",v);o(l,t);o(w,t)}function o(B,z,y){if(!B){return}try{B(z,y)}catch(A){d.utils.error(A)}}}if(i.savePhoto){a.saveToGallery=function(j,m){switch(typeof m){case"undefined":m=function(){};case"function":break;default:throw TypeError("callback must be a function, got "+m)}try{i.savePhoto({url:j},function(n){k(!!n)})}catch(l){k(false)}function k(n){k=function(){};m(n)}}}})(window,document,cards);(function(j,k,h){var a;try{a=h._.bridge("Keyboard")}catch(e){}var l="kik-hide-form-helpers";var g=false;i();h.formHelpers={show:f,hide:d,isEnabled:b};function i(){var m;Array.prototype.forEach.call(k.getElementsByTagName("meta"),function(n){if(n.name===l){m=(n.content||"").trim()}});if(m==="true"){c(false);g=true}}function d(){c(false)}function f(){c(true)}function c(m){if(g){return}if(cards._.secondBatch){cards._.secondBatch.push({name:"Keyboard.setFormHelpers",args:{enabled:m}})}else{try{a.setFormNavigationEnabled({enabled:m})}catch(n){}}}function b(){try{return !!a.isFormNavigationEnabled().enabled}catch(m){return !!h.utils.platform.os.ios}}})(window,document,cards);(function(g,b,h){var a;try{a=h._.bridge("Push")}catch(f){return}var c=h.events();h.push=c;if(a.setBadgeVisibility){c.badge=function(i){a.setBadgeVisibility({visible:!!i})}}if(a.getPushToken){c.getToken=function(i){if(typeof i!=="function"){throw TypeError("callback must be a function, got "+i)}a.getPushToken(function(j){i(j&&j.token)})}}if(a.getNotificationList){var d=h.events.handlers();var e=function(){var o;try{if(h._.firstBatch&&h._.firstBatch["Push.getNotificationList"]){o=h._.firstBatch["Push.getNotificationList"]}else{o=a.getNotificationList()}}catch(n){}if(a.setBadgeVisibility&&!(h._.firstBatch&&h._.firstBatch["Push.setBadgeVisibility"])){try{a.setBadgeVisibility({visible:false})}catch(n){}}if(o&&o.notifications){var m=[];for(var k=0,j=o.notifications.length;k<j;k++){if(typeof o.notifications[k]==="object"){switch(typeof o.notifications[k].data){case"object":m.push(o.notifications[k].data);break;case"string":try{var p=JSON.parse(o.notifications[k].data);if(typeof p==="object"){m.push(p)}else{}}catch(n){}break;default:break}}}d.triggerMulti(m)}else{}};c.handler=function(i){return d.handler(i)};a.on("notificationReceived",function(){setTimeout(e,0)});e()}})(window,document,cards);(function(e,f,a){var g;try{g=a._.bridge("Picker")}catch(b){return}if(!g.startRequest){return}var d=a.events(h);a.picker=d;function h(k,j,l){if(typeof k!=="string"){throw TypeError("picker url must be a string, got "+k)}switch(typeof j){case"function":caller=j;case"undefined":j={};case"object":break;default:throw TypeError("picker options must be an object if defined, got "+j)}if(typeof l!=="function"){throw TypeError("picker callback must be a function, got "+l)}g.startRequest({requestUrl:k,requestData:j},function(m){l(m&&m.responseData)})}if(g.getRequest&&g.completeRequest){var c,i;try{c=(a._.secondBatch?a._.firstBatch["Picker.getRequest"]:g.getRequest()).requestData}catch(b){}if(c&&f.referrer){i=!!(c&&c.kik&&(f.referrer.split("?")[0]==="https://kik.com/"));d.url=f.referrer;d.data=c;d.fromKik=i;d.reply=function(k){if(i&&k){k=a.kik._formatMessage(k)}try{g.completeRequest({responseData:k})}catch(j){}};d.cancel=function(){try{g.cancelRequest()}catch(j){}d.url=undefined;d.data=undefined;d.reply=undefined;d.cancel=undefined;d.trigger("cancel")}}else{}}else{}})(window,document,cards);(function(f,g,b){var h;try{h=b._.bridge("IAP")}catch(d){return}if(!h.purchase||!h.markTransactionStored||!h.getAvailableItems||!h.getTransactionList){return}var c=b.events(a);c.init=i;b.purchase=c;function i(k){if(typeof arguments[0]==="string"){k=Array.prototype.slice.call(k)}if(!Array.isArray(k)){throw TypeError("list of SKUs must be an array")}k.forEach(function(n){if(typeof n!=="string"){throw TypeError("SKU must be a string, got "+n)}});var j,m;try{j=h.getAvailableItems({skus:k}).items;m=h.getTransactionList().transactions}catch(l){}if(!j||!m){throw TypeError("failed to receive access to Purchase APIs")}c.init=null;c.complete=e;c.items=j;c.pending=m}function a(m,k,l){switch(typeof m){case"object":if(m===null){throw TypeError("SKU must be a string, got "+m)}if(typeof m.sku!=="string"){throw TypeError("SKU must be a string, got "+m.sku)}m=m.sku;case"string":break;default:throw TypeError("SKU must be a string, got "+m)}var j=c.items.map(function(n){return n.sku}).indexOf(m);if(j===-1){throw TypeError("SKU not available, got "+m)}switch(typeof k){case"function":l=k;k=undefined;case"undefined":k={};case"object":break;default:throw TypeError("purchase data must be a JSON object if defined, got "+k)}switch(typeof l){case"undefined":l=function(){};case"function":break;default:throw TypeError("purchase callback must be a function if defined, got "+l)}h.purchase({sku:m,data:k},function(n){if(!n||!n.transaction){l();return}c.pending.push(n.transaction);l(n.transaction)})}function e(k){if(typeof k!=="string"){throw TypeError("transactionId must be a string, got "+k)}h.markTransactionStored({transactionId:k});for(var j=c.pending.length;j--;){if(c.pending[j].transactionId===k){c.pending.splice(j,1)}}}})(window,document,cards);(function(a){delete a._.firstBatch;if(a._.secondBatch){a._.bridge.batch(a._.secondBatch);delete a._.secondBatch}})(cards);(function(i,j,a){var c="kik-prefer",g="kik-more",d="kik-unsupported",f="//s3.amazonaws.com/cdn.kik.com/cards/unsupported.html?unsupportedos=true";b();l();function b(){if(a.enabled){return}var n=a.utils.url;if(n.query._app_platform){return}var o="card"+n.updateQuery({kikme:null}).substr(4),m=!!n.query.kikme,p;if(!m){Array.prototype.forEach.call(j.getElementsByTagName("meta"),function(q){if((q.name===c)&&(q.content||"").trim()){m=true}else{if(q.name===g){p=(q.content||"").trim()}}});if(p&&(p!==i.location.host)){m=false}}if(m){a.open.card(o,undefined,true)}}function e(){var s=a.utils.platform.os,o;Array.prototype.forEach.call(j.getElementsByTagName("meta"),function(u){if(u.name===d){o=(u.content||"").trim()}});if(!o){return true}var m=true;var t=o.split(",");for(var q=0,n=t.length;q<n;q++){var r=t[q].trim();var p=h(r);if(r&&p){if(p.ios&&s.ios){if(s.version<(p.version+1)){m=false}}else{if(p.android&&s.android){if(s.version<=p.version){m=false}}}}}return m}function h(m){var p=-1,o=false,n=false;if(m.indexOf("android-")===0){n=true;p=parseFloat(m.replace("android-",""));if(p>=2.3){return k(m)}}else{if(m.indexOf("ios-")===0){o=true;p=parseFloat(m.replace("ios-",""));if(p>=5){return k(m)}}else{return k(m)}}return{ios:o,android:n,version:p}}function k(m){if(i.console&&i.console.error){i.console.error('"'+m+'" is an unsupported value for the "'+d+'" meta tag')}return false}function l(){if(e()){return}var p=j.documentElement;Array.prototype.forEach.call(p.childNodes,function(q){p.removeChild(q)});p.style.height="100%";p.style.width="100%";p.style.padding="0";p.style.border="none";p.style.margin="0";p.style.overflow="hidden";var m=j.createElement("head"),o=j.createElement("meta");o.name="viewport";o.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";m.appendChild(o);p.appendChild(m);var n=j.createElement("iframe");n.src=f;n.style.zIndex="99999999";n.style.position="fixed";n.style.top="0";n.style.left="0";n.style.height="100%";n.style.width="100%";n.style.border="none";n.style["-webkit-transform"]="translate3d(0,0,0)";p.appendChild(n);p.style.background=n.style.background}})(window,document,cards);